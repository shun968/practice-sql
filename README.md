# Practice SQL

MySQLã‚’ä½¿ç”¨ã—ãŸSQLå­¦ç¿’ãƒ»ç·´ç¿’ç’°å¢ƒã§ã™ã€‚Dockerã‚’ä½¿ç”¨ã—ã¦ç°¡å˜ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ãã¾ã™ã€‚

## ç‰¹å¾´

- ğŸ³ Docker Composeã«ã‚ˆã‚‹ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- ğŸ“Š å®Ÿè¡Œè¨ˆç”»ã®ç¢ºèªæ©Ÿèƒ½
- ğŸ”„ ã‚«ã‚¹ã‚¿ãƒ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- ğŸ“ˆ ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æã‚¯ã‚¨ãƒªç®¡ç†
- ğŸ› ï¸ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆç®¡ç†
- ğŸ“ ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- ğŸ“š è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
practice-sql/
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ mysql/
â”‚       â”œâ”€â”€ compose.yaml          # Docker Composeè¨­å®š
â”‚       â”œâ”€â”€ config/
â”‚       â”‚   â””â”€â”€ mysql.cnf         # MySQLè¨­å®š
â”‚       â””â”€â”€ init/                 # DBåˆæœŸåŒ–æ™‚ã®ã¿å®Ÿè¡Œ
â”‚           â”œâ”€â”€ 01-init.sql
â”‚           â””â”€â”€ 02-init.sql
â”œâ”€â”€ sql/                         # ä»»æ„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã™ã‚‹SQL
â”‚   â”œâ”€â”€ migrations/              # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ 001_create_users_table.sql
â”‚   â”‚   â”œâ”€â”€ 002_create_orders_table.sql
â”‚   â”‚   â”œâ”€â”€ 003_create_warehouse_table.sql
â”‚   â”‚   â””â”€â”€ 004_create_analysis_tables.sql
â”‚   â”œâ”€â”€ seeds/                   # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ»åˆæœŸãƒ‡ãƒ¼ã‚¿
â”‚   â”‚   â”œâ”€â”€ 001_sample_users.sql
â”‚   â”‚   â”œâ”€â”€ 002_sample_warehouse.sql
â”‚   â”‚   â””â”€â”€ 004_sample_analysis_data.sql
â”‚   â”œâ”€â”€ queries/                 # åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”¨ã‚¯ã‚¨ãƒª
â”‚   â”‚   â”œâ”€â”€ reports/
â”‚   â”‚   â”‚   â””â”€â”€ user_statistics.sql
â”‚   â”‚   â””â”€â”€ analysis/
â”‚   â”‚       â”œâ”€â”€ warehouse_city_mapping.sql
â”‚   â”‚       â””â”€â”€ correlated_subquery_vs_window.sql
â”‚   â””â”€â”€ maintenance/             # ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚       â””â”€â”€ cleanup_old_data.sql
â”œâ”€â”€ scripts/                     # SQLå®Ÿè¡Œç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ run_migration.sh
â”‚   â””â”€â”€ run_query.sh
â”œâ”€â”€ docs/                        # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ migration.md
â”‚   â”œâ”€â”€ analyze-mysql.md
â”‚   â””â”€â”€ github-directory.md
â””â”€â”€ Makefile                     # ç®¡ç†ã‚³ãƒãƒ³ãƒ‰
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone <repository-url>
cd practice-sql
```

### 2. MySQLã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

```bash
make up
```

### 3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ

```bash
make migrate
```

### 4. ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å®Ÿè¡Œ

```bash
make seed
```

### 5. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç¢ºèª

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã«ã¤ã„ã¦
cat docs/migration.md

# MySQLå®Ÿè¡Œè¨ˆç”»åˆ†æã«ã¤ã„ã¦
cat docs/analyze-mysql.md

# GitHubãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®šã«ã¤ã„ã¦
cat docs/github-directory.md
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªã‚³ãƒãƒ³ãƒ‰

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
make up

# ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢
make down

# MySQLã«æ¥ç¶š
make connect

# ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
make status
```

### SQLãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# å…¨ã¦ã®æœªå®Ÿè¡Œãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
make migrate

# ç‰¹å®šã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
make migrate-file FILE=sql/migrations/001_create_users_table.sql

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’è¡¨ç¤º
make migration-history
```

è©³ç´°ã«ã¤ã„ã¦ã¯ `docs/migration.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿

```bash
# ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å®Ÿè¡Œ
make seed
```

#### ã‚¯ã‚¨ãƒªå®Ÿè¡Œ

```bash
# ã‚¯ã‚¨ãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
make query FILE=sql/queries/reports/user_statistics.sql

# ç›´æ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼ˆå‡ºåŠ›å½¢å¼æŒ‡å®šå¯èƒ½ï¼‰
./scripts/run_query.sh sql/queries/reports/user_statistics.sql csv
./scripts/run_query.sh sql/queries/reports/user_statistics.sql json
```

#### ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

```bash
# ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
make maintenance
```

### å®Ÿè¡Œè¨ˆç”»ã®ç¢ºèª

MySQLã«æ¥ç¶šã—ã¦å®Ÿè¡Œè¨ˆç”»ã‚’ç¢ºèªã§ãã¾ã™ï¼š

```sql
-- åŸºæœ¬çš„ãªå®Ÿè¡Œè¨ˆç”»
EXPLAIN SELECT * FROM users WHERE email = 'test@example.com';

-- JSONå½¢å¼ã§ã®è©³ç´°ãªå®Ÿè¡Œè¨ˆç”»
EXPLAIN FORMAT=JSON SELECT * FROM users WHERE email = 'test@example.com';

-- å®Ÿéš›ã«ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦å®Ÿè¡Œæ™‚é–“ã‚‚è¡¨ç¤º
EXPLAIN ANALYZE SELECT * FROM users WHERE email = 'test@example.com';
```

è©³ç´°ã«ã¤ã„ã¦ã¯ `docs/analyze-mysql.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## GitHubè¨­å®š

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€GitHubã®æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã¦å“è³ªå‘ä¸Šã¨åŠ¹ç‡åŒ–ã‚’å›³ã£ã¦ã„ã¾ã™ï¼š

- **GitHub Actions**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®è‡ªå‹•å®Ÿè¡Œ
- **Dependabot**: ä¾å­˜é–¢ä¿‚ã®è‡ªå‹•æ›´æ–°
- **Issue/PRãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: æ¨™æº–åŒ–ã•ã‚ŒãŸå ±å‘Šãƒ»ææ¡ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

è©³ç´°ã«ã¤ã„ã¦ã¯ `docs/github-directory.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±

- **Host**: localhost
- **Port**: 3306
- **Database**: practice_db
- **Username**: practice_user
- **Password**: practice_password
- **Root Password**: rootpassword

## ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«

- ãƒ•ã‚¡ã‚¤ãƒ«åã¯ `001_`, `002_` ã®ã‚ˆã†ã«é€£ç•ªã§ç®¡ç†
- å„ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰
- å®Ÿè¡Œå±¥æ­´ã¯ `migration_history` ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†
- è©³ç´°ã«ã¤ã„ã¦ã¯ `docs/migration.md` ã‚’å‚ç…§

### ã‚¯ã‚¨ãƒªãƒ•ã‚¡ã‚¤ãƒ«

- ç”¨é€”åˆ¥ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†ã‘ã‚‹ï¼ˆreports, analysisç­‰ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«åã¯å†…å®¹ã‚’è¡¨ã™åå‰ã«ã™ã‚‹
- è¤‡é›‘ãªã‚¯ã‚¨ãƒªã«ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰

### ã‚·ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«

- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚„åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†
- `ON DUPLICATE KEY UPDATE` ã‚’ä½¿ç”¨ã—ã¦å†ªç­‰æ€§ã‚’ä¿ã¤

### ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«

- å®šæœŸçš„ã«å®Ÿè¡Œã™ã‚‹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚„æœ€é©åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- å®Ÿè¡Œå‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹ã“ã¨ã‚’æ¨å¥¨

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Docker Desktopã®ã‚¨ãƒ©ãƒ¼

Docker Desktopã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

```bash
# Dockerã‚·ã‚¹ãƒ†ãƒ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
docker system prune -a --volumes -f

# Docker Desktopã‚’å†èµ·å‹•
# ãã®å¾Œã€make up ã‚’å®Ÿè¡Œ
```

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’ç¢ºèª
make migration-history

# ç‰¹å®šã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†å®Ÿè¡Œ
make migrate-file FILE=sql/migrations/001_create_users_table.sql
```

## é–‹ç™ºè€…å‘ã‘æƒ…å ±

### æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è¿½åŠ 

1. `sql/migrations/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. ãƒ•ã‚¡ã‚¤ãƒ«åã¯é€£ç•ªã§ç®¡ç†ï¼ˆä¾‹: `003_add_new_table.sql`ï¼‰
3. é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¼‰
4. `make migrate` ã§å®Ÿè¡Œ

### æ–°ã—ã„ã‚¯ã‚¨ãƒªã®è¿½åŠ 

1. ç”¨é€”ã«å¿œã˜ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. ãƒ•ã‚¡ã‚¤ãƒ«åã¯å†…å®¹ã‚’è¡¨ã™åå‰ã«ã™ã‚‹
3. `make query FILE=path/to/query.sql` ã§å®Ÿè¡Œ

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

